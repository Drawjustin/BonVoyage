(this["webpackJsonpopenvidu-call-react"]=this["webpackJsonpopenvidu-call-react"]||[]).push([[0],{121:function(e,t,a){e.exports=a(189)},126:function(e,t,a){},179:function(e,t,a){},185:function(e,t,a){},186:function(e,t,a){},187:function(e,t,a){},188:function(e,t,a){e.exports=a.p+"static/media/openvidu_logo.4af4a556.png"},189:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),s=a(17),o=a.n(s),r=(a(126),a(18)),c=a.n(r),l=a(28),u=a(13),h=a(14),d=a(4),m=a(21),g=a(20),v=a(61),p=a.n(v),f=a(98),S=a(222),b=a(224),y=a(45),k=a.n(y),C=a(104),E=a.n(C),w=(a(179),a(233)),O=function(e){Object(m.a)(a,e);var t=Object(g.a)(a);function a(e){var i;return Object(u.a)(this,a),(i=t.call(this,e)).state={messageList:[],message:""},i.chatScroll=n.a.createRef(),i.handleChange=i.handleChange.bind(Object(d.a)(i)),i.handlePressKey=i.handlePressKey.bind(Object(d.a)(i)),i.close=i.close.bind(Object(d.a)(i)),i.sendMessage=i.sendMessage.bind(Object(d.a)(i)),i}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.user.getStreamManager().stream.session.on("signal:chat",(function(t){var a=JSON.parse(t.data),i=e.state.messageList;i.push({connectionId:t.from.connectionId,nickname:a.nickname,message:a.message});var n=window.document;setTimeout((function(){var t=n.getElementById("userImg-"+(e.state.messageList.length-1)),i=n.getElementById("video-"+a.streamId);t.getContext("2d").drawImage(i,200,120,285,285,0,0,60,60),e.props.messageReceived()}),50),e.setState({messageList:i}),e.scrollToBottom()}))}},{key:"handleChange",value:function(e){this.setState({message:e.target.value})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&this.sendMessage()}},{key:"sendMessage",value:function(){if(console.log(this.state.message),this.props.user&&this.state.message){var e=this.state.message.replace(/ +(?= )/g,"");if(""!==e&&" "!==e){var t={message:e,nickname:this.props.user.getNickname(),streamId:this.props.user.getStreamManager().stream.streamId};this.props.user.getStreamManager().stream.session.signal({data:JSON.stringify(t),type:"chat"})}}this.setState({message:""})}},{key:"scrollToBottom",value:function(){var e=this;setTimeout((function(){try{e.chatScroll.current.scrollTop=e.chatScroll.current.scrollHeight}catch(t){}}),20)}},{key:"close",value:function(){this.props.close(void 0)}},{key:"render",value:function(){var e=this,t={display:this.props.chatDisplay};return n.a.createElement("div",{id:"chatContainer"},n.a.createElement("div",{id:"chatComponent",style:t},n.a.createElement("div",{id:"chatToolbar"},n.a.createElement("span",null,this.props.user.getStreamManager().stream.session.sessionId," - CHAT"),n.a.createElement(S.a,{id:"closeButton",onClick:this.close},n.a.createElement(k.a,{color:"secondary"}))),n.a.createElement("div",{className:"message-wrap",ref:this.chatScroll},this.state.messageList.map((function(t,a){return n.a.createElement("div",{key:a,id:"remoteUsers",className:"message"+(t.connectionId!==e.props.user.getConnectionId()?" left":" right")},n.a.createElement("canvas",{id:"userImg-"+a,width:"60",height:"60",className:"user-img"}),n.a.createElement("div",{className:"msg-detail"},n.a.createElement("div",{className:"msg-info"},n.a.createElement("p",null," ",t.nickname)),n.a.createElement("div",{className:"msg-content"},n.a.createElement("span",{className:"triangle"}),n.a.createElement("p",{className:"text"},t.message))))}))),n.a.createElement("div",{id:"messageInput"},n.a.createElement("input",{placeholder:"Send a messge",id:"chatInput",value:this.state.message,onChange:this.handleChange,onKeyPress:this.handlePressKey}),n.a.createElement(w.a,{title:"Send message"},n.a.createElement(b.a,{size:"small",id:"sendButton",onClick:this.sendMessage},n.a.createElement(E.a,null))))))}}]),a}(i.Component),A=a(225),N=a(228),x=a(226),R=a(227),j=a(229),M=(a(185),function(e){Object(m.a)(a,e);var t=Object(g.a)(a);function a(e){var i;return Object(u.a)(this,a),(i=t.call(this,e)).openviduExtensionUrl="https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",i.state={isInstalled:!1},i.goToChromePage=i.goToChromePage.bind(Object(d.a)(i)),i.onNoClick=i.onNoClick.bind(Object(d.a)(i)),i.refreshBrowser=i.refreshBrowser.bind(Object(d.a)(i)),i}return Object(h.a)(a,[{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidMount",value:function(){}},{key:"onNoClick",value:function(){this.props.cancelClicked()}},{key:"goToChromePage",value:function(){window.open(this.openviduExtensionUrl),this.setState({isInstalled:!0})}},{key:"refreshBrowser",value:function(){window.location.reload()}},{key:"render",value:function(){return n.a.createElement("div",null,this.props&&this.props.showDialog?n.a.createElement("div",{id:"dialogExtension"},n.a.createElement(A.a,{id:"card"},n.a.createElement(x.a,null,n.a.createElement(R.a,{color:"textSecondary"},"Hello"),n.a.createElement(R.a,{color:"textSecondary"},"You need install this chrome extension and refresh the browser for can share your screen.")),n.a.createElement(N.a,null,n.a.createElement(j.a,{size:"small",onClick:this.onNoClick},"Cancel"),n.a.createElement(j.a,{size:"small",onClick:this.goToChromePage},"Install"),this.state.isInstalled?n.a.createElement(j.a,{size:"small",onClick:this.refreshBrowser},"Refresh"):null))):null)}}]),a}(i.Component)),I=(a(96),function(e){Object(m.a)(a,e);var t=Object(g.a)(a);function a(e){var i;return Object(u.a)(this,a),(i=t.call(this,e)).videoRef=n.a.createRef(),i}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props&&this.props.user.streamManager&&this.videoRef&&(console.log("PROPS: ",this.props),this.props.user.getStreamManager().addVideoElement(this.videoRef.current)),this.props&&this.props.user.streamManager.session&&this.props.user&&this.videoRef&&this.props.user.streamManager.session.on("signal:userChanged",(function(t){void 0!==JSON.parse(t.data).isScreenShareActive&&e.props.user.getStreamManager().addVideoElement(e.videoRef.current)}))}},{key:"componentDidUpdate",value:function(e){e&&this.videoRef&&this.props.user.getStreamManager().addVideoElement(this.videoRef.current)}},{key:"render",value:function(){return n.a.createElement("video",{autoPlay:!0,id:"video-"+this.props.user.getStreamManager().stream.streamId,ref:this.videoRef,muted:this.props.mutedSound})}}]),a}(i.Component)),F=a(47),T=a.n(F),U=a(46),V=a.n(U),D=a(106),L=a.n(D),B=a(105),P=a.n(B),_=a(235),W=a(234),z=a(236),q=a(230),H=function(e){Object(m.a)(a,e);var t=Object(g.a)(a);function a(e){var i;return Object(u.a)(this,a),(i=t.call(this,e)).state={nickname:i.props.user.getNickname(),showForm:!1,mutedSound:!1,isFormValid:!0},i.handleChange=i.handleChange.bind(Object(d.a)(i)),i.handlePressKey=i.handlePressKey.bind(Object(d.a)(i)),i.toggleNicknameForm=i.toggleNicknameForm.bind(Object(d.a)(i)),i.toggleSound=i.toggleSound.bind(Object(d.a)(i)),i}return Object(h.a)(a,[{key:"handleChange",value:function(e){this.setState({nickname:e.target.value}),e.preventDefault()}},{key:"toggleNicknameForm",value:function(){this.props.user.isLocal()&&this.setState({showForm:!this.state.showForm})}},{key:"toggleSound",value:function(){this.setState({mutedSound:!this.state.mutedSound})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&(console.log(this.state.nickname),this.state.nickname.length>=3&&this.state.nickname.length<=20?(this.props.handleNickname(this.state.nickname),this.toggleNicknameForm(),this.setState({isFormValid:!0})):this.setState({isFormValid:!1}))}},{key:"render",value:function(){return n.a.createElement("div",{className:"OT_widget-container"},n.a.createElement("div",{className:"pointer nickname"},this.state.showForm?n.a.createElement(_.a,{id:"nicknameForm"},n.a.createElement(S.a,{color:"inherit",id:"closeButton",onClick:this.toggleNicknameForm},n.a.createElement(k.a,null)),n.a.createElement(z.a,{htmlFor:"name-simple",id:"label"},"Nickname"),n.a.createElement(W.a,{color:"inherit",id:"input",value:this.state.nickname,onChange:this.handleChange,onKeyPress:this.handlePressKey,required:!0}),!this.state.isFormValid&&this.state.nickname.length<=3&&n.a.createElement(q.a,{id:"name-error-text"},"Nickname is too short!"),!this.state.isFormValid&&this.state.nickname.length>=20&&n.a.createElement(q.a,{id:"name-error-text"},"Nickname is too long!")):n.a.createElement("div",{onClick:this.toggleNicknameForm},n.a.createElement("span",{id:"nickname"},this.props.user.getNickname()),this.props.user.isLocal()&&n.a.createElement("span",{id:""}," (edit)"))),void 0!==this.props.user&&void 0!==this.props.user.getStreamManager()?n.a.createElement("div",{className:"streamComponent"},n.a.createElement(I,{user:this.props.user,mutedSound:this.state.mutedSound}),n.a.createElement("div",{id:"statusIcons"},this.props.user.isVideoActive()?null:n.a.createElement("div",{id:"camIcon"},n.a.createElement(V.a,{id:"statusCam"})),this.props.user.isAudioActive()?null:n.a.createElement("div",{id:"micIcon"},n.a.createElement(T.a,{id:"statusMic"}))),n.a.createElement("div",null,!this.props.user.isLocal()&&n.a.createElement(S.a,{id:"volumeButton",onClick:this.toggleSound},this.state.mutedSound?n.a.createElement(P.a,{color:"secondary"}):n.a.createElement(L.a,null)))):null)}}]),a}(i.Component),K=(a(186),a(24)),J=a.n(K),Y=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"fixAspectRatio",value:function(e,t){var a=e.querySelector(".OT_root");if(a){var i=a.style.width;a.style.width=t+"px",a.style.width=i||""}}},{key:"positionElement",value:function(e,t,a,i,n,s){var o=this,r={left:t+"px",top:a+"px",width:i+"px",height:n+"px"};this.fixAspectRatio(e,i),s&&J.a?(J()(e).stop(),J()(e).animate(r,s.duration||200,s.easing||"swing",(function(){o.fixAspectRatio(e,i),s.complete&&s.complete.call(o)}))):J()(e).css(r),this.fixAspectRatio(e,i)}},{key:"getVideoRatio",value:function(e){if(!e)return 3/4;var t=e.querySelector("video");return t&&t.videoHeight&&t.videoWidth?t.videoHeight/t.videoWidth:e.videoHeight&&e.videoWidth?e.videoHeight/e.videoWidth:3/4}},{key:"getCSSNumber",value:function(e,t){var a=J()(e).css(t);return a?parseInt(a,10):0}},{key:"cheapUUID",value:function(){return(1e8*Math.random()).toFixed(0)}},{key:"getHeight",value:function(e){var t=J()(e).css("height");return t?parseInt(t,10):0}},{key:"getWidth",value:function(e){var t=J()(e).css("width");return t?parseInt(t,10):0}},{key:"getBestDimensions",value:function(e,t,a,i,n,s){for(var o,r,c,l,u,h,d,m=1;m<=a;m++){var g=m,v=Math.ceil(a/g);(d=(h=Math.floor(n/v))/(u=Math.floor(i/g)))>t?h=u*(d=t):d<e&&(u=h/(d=e));var p=u*h*a;(void 0===o||p>o)&&(o=p,s=h,l=u,r=g,c=v)}return{maxArea:o,targetCols:r,targetRows:c,targetHeight:s,targetWidth:l,ratio:s/l}}},{key:"arrange",value:function(e,t,a,i,n,s,o,r,c){var l,u,h=e.length;if(s){var d=this.getVideoRatio(e.length>0?e[0]:null);u=this.getBestDimensions(d,d,h,t,a,l)}else u=this.getBestDimensions(o,r,h,t,a,l);for(var m,g=0,v=0,p=[],f=0;f<e.length;f++){f%u.targetCols===0&&(m={children:[],width:0,height:0},p.push(m));var S=e[f];m.children.push(S);var b=u.targetWidth;l=u.targetHeight,s&&(b=l/this.getVideoRatio(S)),m.width+=b,m.height=l}for(var y=0,k=0,C=0;C<p.length;C++)(m=p[C]).width>t?(m.height=Math.floor(m.height*(t/m.width)),m.width=t):m.width<t&&(k+=1),y+=m.height;if(y<a&&k>0){var E=a-y;y=0;for(var w=0;w<p.length;w++){if((m=p[w]).width<t){var O=E/k;O/m.height>(t-m.width)/m.width&&(O=Math.floor((t-m.width)/m.width*m.height)),m.width+=Math.floor(O/m.height*m.width),m.height+=O,E-=O,k-=1}y+=m.height}}v=(a-y)/2;for(var A=0;A<p.length;A++){g=(t-(m=p[A]).width)/2;for(var N=0;N<m.children.length;N++){var x=m.children[N],R=u.targetWidth;l=m.height,s&&(R=Math.floor(l/this.getVideoRatio(x))),x.style.position="absolute";var j=R-this.getCSSNumber(x,"paddingLeft")-this.getCSSNumber(x,"paddingRight")-this.getCSSNumber(x,"marginLeft")-this.getCSSNumber(x,"marginRight")-this.getCSSNumber(x,"borderLeft")-this.getCSSNumber(x,"borderRight"),M=l-this.getCSSNumber(x,"paddingTop")-this.getCSSNumber(x,"paddingBottom")-this.getCSSNumber(x,"marginTop")-this.getCSSNumber(x,"marginBottom")-this.getCSSNumber(x,"borderTop")-this.getCSSNumber(x,"borderBottom");this.positionElement(x,g+i,v+n,j,M,c),g+=R}v+=l}}},{key:"filterDisplayNone",value:function(e){return"none"!==e.style.display}},{key:"updateLayout",value:function(){if("none"!==this.layoutContainer.style.display){var e=this.layoutContainer.id;e||(e="OT_"+this.cheapUUID(),this.layoutContainer.id=e);var t,a,i=this.getHeight(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderTop")-this.getCSSNumber(this.layoutContainer,"borderBottom"),n=this.getWidth(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderLeft")-this.getCSSNumber(this.layoutContainer,"borderRight"),s=i/n,o=0,r=0,c=0,l=0,u=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">."+this.opts.bigClass),this.filterDisplayNone),h=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">*:not(."+this.opts.bigClass+")"),this.filterDisplayNone);if(u.length>0&&h.length>0)s>this.getVideoRatio(u[0])?(t=n,c=i-(r=a=Math.floor(i*this.opts.bigPercentage))):(a=i,l=n-(o=t=Math.floor(n*this.opts.bigPercentage))),this.opts.bigFirst?(this.arrange(u,t,a,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate),this.arrange(h,n-o,i-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)):(this.arrange(h,n-o,i-r,0,0,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate),this.arrange(u,t,a,l,c,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate));else u.length>0&&0===h.length?this.arrange(u,n,i,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate):this.arrange(h,n-o,i-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)}}},{key:"initLayoutContainer",value:function(e,t){this.opts={maxRatio:null!=t.maxRatio?t.maxRatio:1.5,minRatio:null!=t.minRatio?t.minRatio:9/16,fixedRatio:null!=t.fixedRatio&&t.fixedRatio,animate:null!=t.animate&&t.animate,bigClass:null!=t.bigClass?t.bigClass:"OT_big",bigPercentage:null!=t.bigPercentage?t.bigPercentage:.8,bigFixedRatio:null!=t.bigFixedRatio&&t.bigFixedRatio,bigMaxRatio:null!=t.bigMaxRatio?t.bigMaxRatio:1.5,bigMinRatio:null!=t.bigMinRatio?t.bigMinRatio:9/16,bigFirst:null==t.bigFirst||t.bigFirst},this.layoutContainer="string"===typeof e?J()(e):e}},{key:"setLayoutOptions",value:function(e){this.opts=e}}]),e}(),X=function(){function e(){Object(u.a)(this,e),this.connectionId="",this.audioActive=!0,this.videoActive=!0,this.screenShareActive=!1,this.nickname="",this.streamManager=null,this.type="local"}return Object(h.a)(e,[{key:"isAudioActive",value:function(){return this.audioActive}},{key:"isVideoActive",value:function(){return this.videoActive}},{key:"isScreenShareActive",value:function(){return this.screenShareActive}},{key:"getConnectionId",value:function(){return this.connectionId}},{key:"getNickname",value:function(){return this.nickname}},{key:"getStreamManager",value:function(){return this.streamManager}},{key:"isLocal",value:function(){return"local"===this.type}},{key:"isRemote",value:function(){return!this.isLocal()}},{key:"setAudioActive",value:function(e){this.audioActive=e}},{key:"setVideoActive",value:function(e){this.videoActive=e}},{key:"setScreenShareActive",value:function(e){this.screenShareActive=e}},{key:"setStreamManager",value:function(e){this.streamManager=e}},{key:"setConnectionId",value:function(e){this.connectionId=e}},{key:"setNickname",value:function(e){this.nickname=e}},{key:"setType",value:function(e){"local"===e|"remote"===e&&(this.type=e)}}]),e}(),G=(a(187),a(231)),Q=a(232),$=a(107),Z=a.n($),ee=a(108),te=a.n(ee),ae=a(114),ie=a.n(ae),ne=a(113),se=a.n(ne),oe=a(112),re=a.n(oe),ce=a(109),le=a.n(ce),ue=a(110),he=a.n(ue),de=a(111),me=a.n(de),ge=a(115),ve=a.n(ge),pe=a(116),fe=a.n(pe),Se=a(188),be=function(e){Object(m.a)(a,e);var t=Object(g.a)(a);function a(e){var i;return Object(u.a)(this,a),(i=t.call(this,e)).state={fullscreen:!1},i.camStatusChanged=i.camStatusChanged.bind(Object(d.a)(i)),i.micStatusChanged=i.micStatusChanged.bind(Object(d.a)(i)),i.screenShare=i.screenShare.bind(Object(d.a)(i)),i.stopScreenShare=i.stopScreenShare.bind(Object(d.a)(i)),i.toggleFullscreen=i.toggleFullscreen.bind(Object(d.a)(i)),i.switchCamera=i.switchCamera.bind(Object(d.a)(i)),i.leaveSession=i.leaveSession.bind(Object(d.a)(i)),i.toggleChat=i.toggleChat.bind(Object(d.a)(i)),i}return Object(h.a)(a,[{key:"micStatusChanged",value:function(){this.props.micStatusChanged()}},{key:"camStatusChanged",value:function(){this.props.camStatusChanged()}},{key:"screenShare",value:function(){this.props.screenShare()}},{key:"stopScreenShare",value:function(){this.props.stopScreenShare()}},{key:"toggleFullscreen",value:function(){this.setState({fullscreen:!this.state.fullscreen}),this.props.toggleFullscreen()}},{key:"switchCamera",value:function(){this.props.switchCamera()}},{key:"leaveSession",value:function(){this.props.leaveSession()}},{key:"toggleChat",value:function(){this.props.toggleChat()}},{key:"render",value:function(){var e=this.props.sessionId,t=this.props.user;return n.a.createElement(G.a,{className:"toolbar",id:"header"},n.a.createElement(Q.a,{className:"toolbar"},n.a.createElement("div",{id:"navSessionInfo"},n.a.createElement("img",{id:"header_img",alt:"OpenVidu Logo",src:Se}),this.props.sessionId&&n.a.createElement("div",{id:"titleContent"},n.a.createElement("span",{id:"session-title"},e))),n.a.createElement("div",{className:"buttonsContent"},n.a.createElement(S.a,{color:"inherit",className:"navButton",id:"navMicButton",onClick:this.micStatusChanged},void 0!==t&&t.isAudioActive()?n.a.createElement(Z.a,null):n.a.createElement(T.a,{color:"secondary"})),n.a.createElement(S.a,{color:"inherit",className:"navButton",id:"navCamButton",onClick:this.camStatusChanged},void 0!==t&&t.isVideoActive()?n.a.createElement(te.a,null):n.a.createElement(V.a,{color:"secondary"})),n.a.createElement(S.a,{color:"inherit",className:"navButton",onClick:this.screenShare},void 0!==t&&t.isScreenShareActive()?n.a.createElement(le.a,null):n.a.createElement(he.a,null)),void 0!==t&&t.isScreenShareActive()&&n.a.createElement(S.a,{onClick:this.stopScreenShare,id:"navScreenButton"},n.a.createElement(me.a,{color:"secondary"})),n.a.createElement(S.a,{color:"inherit",className:"navButton",onClick:this.switchCamera},n.a.createElement(re.a,null)),n.a.createElement(S.a,{color:"inherit",className:"navButton",onClick:this.toggleFullscreen},void 0!==t&&this.state.fullscreen?n.a.createElement(se.a,null):n.a.createElement(ie.a,null)),n.a.createElement(S.a,{color:"secondary",className:"navButton",onClick:this.leaveSession,id:"navLeaveButton"},n.a.createElement(ve.a,null)),n.a.createElement(S.a,{color:"inherit",onClick:this.toggleChat,id:"navChatButton"},this.props.showNotification&&n.a.createElement("div",{id:"point",className:""}),n.a.createElement(w.a,{title:"Chat"},n.a.createElement(fe.a,null))))))}}]),a}(i.Component),ye=new X,ke=function(e){Object(m.a)(a,e);var t=Object(g.a)(a);function a(e){var i;Object(u.a)(this,a),(i=t.call(this,e)).hasBeenUpdated=!1,i.layout=new Y;var n=i.props.sessionName?i.props.sessionName:"SessionA",s=i.props.user?i.props.user:"OpenVidu_User"+Math.floor(100*Math.random());return i.remotes=[],i.localUserAccessAllowed=!1,i.state={mySessionId:n,myUserName:s,session:void 0,localUser:void 0,subscribers:[],chatDisplay:"none",currentVideoDevice:void 0},i.joinSession=i.joinSession.bind(Object(d.a)(i)),i.leaveSession=i.leaveSession.bind(Object(d.a)(i)),i.onbeforeunload=i.onbeforeunload.bind(Object(d.a)(i)),i.updateLayout=i.updateLayout.bind(Object(d.a)(i)),i.camStatusChanged=i.camStatusChanged.bind(Object(d.a)(i)),i.micStatusChanged=i.micStatusChanged.bind(Object(d.a)(i)),i.nicknameChanged=i.nicknameChanged.bind(Object(d.a)(i)),i.toggleFullscreen=i.toggleFullscreen.bind(Object(d.a)(i)),i.switchCamera=i.switchCamera.bind(Object(d.a)(i)),i.screenShare=i.screenShare.bind(Object(d.a)(i)),i.stopScreenShare=i.stopScreenShare.bind(Object(d.a)(i)),i.closeDialogExtension=i.closeDialogExtension.bind(Object(d.a)(i)),i.toggleChat=i.toggleChat.bind(Object(d.a)(i)),i.checkNotification=i.checkNotification.bind(Object(d.a)(i)),i.checkSize=i.checkSize.bind(Object(d.a)(i)),i}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.layout.initLayoutContainer(document.getElementById("layout"),{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0}),window.addEventListener("beforeunload",this.onbeforeunload),window.addEventListener("resize",this.updateLayout),window.addEventListener("resize",this.checkSize),this.joinSession()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onbeforeunload),window.removeEventListener("resize",this.updateLayout),window.removeEventListener("resize",this.checkSize),this.leaveSession()}},{key:"onbeforeunload",value:function(e){this.leaveSession()}},{key:"joinSession",value:function(){var e=this;this.OV=new f.OpenVidu,this.setState({session:this.OV.initSession()},Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.subscribeToStreamCreated(),t.next=3,e.connectToSession();case 3:case"end":return t.stop()}}),t)}))))}},{key:"connectToSession",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.props.token){e.next=5;break}console.log("token received: ",this.props.token),this.connect(this.props.token),e.next=17;break;case 5:return e.prev=5,e.next=8,this.getToken();case 8:t=e.sent,this.connect(t),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(5),console.error("There was an error getting the token:",e.t0.code,e.t0.message),this.props.error&&this.props.error({error:e.t0.error,messgae:e.t0.message,code:e.t0.code,status:e.t0.status}),alert("There was an error getting the token:",e.t0.message);case 17:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(e){var t=this;this.state.session.connect(e,{clientData:this.state.myUserName}).then((function(){t.connectWebCam()})).catch((function(e){t.props.error&&t.props.error({error:e.error,messgae:e.message,code:e.code,status:e.status}),alert("There was an error connecting to the session:",e.message),console.log("There was an error connecting to the session:",e.code,e.message)}))}},{key:"connectWebCam",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,i,n=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.OV.getUserMedia({audioSource:void 0,videoSource:void 0});case 2:return e.next=4,this.OV.getDevices();case 4:t=e.sent,a=t.filter((function(e){return"videoinput"===e.kind})),i=this.OV.initPublisher(void 0,{audioSource:void 0,videoSource:a[0].deviceId,publishAudio:ye.isAudioActive(),publishVideo:ye.isVideoActive(),resolution:"640x480",frameRate:30,insertMode:"APPEND"}),this.state.session.capabilities.publish&&i.on("accessAllowed",(function(){n.state.session.publish(i).then((function(){n.updateSubscribers(),n.localUserAccessAllowed=!0,n.props.joinSession&&n.props.joinSession()}))})),ye.setNickname(this.state.myUserName),ye.setConnectionId(this.state.session.connection.connectionId),ye.setScreenShareActive(!1),ye.setStreamManager(i),this.subscribeToUserChanged(),this.subscribeToStreamDestroyed(),this.sendSignalUserChanged({isScreenShareActive:ye.isScreenShareActive()}),this.setState({currentVideoDevice:a[0],localUser:ye},(function(){n.state.localUser.getStreamManager().on("streamPlaying",(function(e){n.updateLayout(),i.videos[0].video.parentElement.classList.remove("custom-class")}))}));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateSubscribers",value:function(){var e=this,t=this.remotes;this.setState({subscribers:t},(function(){e.state.localUser&&e.sendSignalUserChanged({isAudioActive:e.state.localUser.isAudioActive(),isVideoActive:e.state.localUser.isVideoActive(),nickname:e.state.localUser.getNickname(),isScreenShareActive:e.state.localUser.isScreenShareActive()}),e.updateLayout()}))}},{key:"leaveSession",value:function(){var e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"OpenVidu_User"+Math.floor(100*Math.random()),localUser:void 0}),this.props.leaveSession&&this.props.leaveSession()}},{key:"camStatusChanged",value:function(){ye.setVideoActive(!ye.isVideoActive()),ye.getStreamManager().publishVideo(ye.isVideoActive()),this.sendSignalUserChanged({isVideoActive:ye.isVideoActive()}),this.setState({localUser:ye})}},{key:"micStatusChanged",value:function(){ye.setAudioActive(!ye.isAudioActive()),ye.getStreamManager().publishAudio(ye.isAudioActive()),this.sendSignalUserChanged({isAudioActive:ye.isAudioActive()}),this.setState({localUser:ye})}},{key:"nicknameChanged",value:function(e){var t=this.state.localUser;t.setNickname(e),this.setState({localUser:t}),this.sendSignalUserChanged({nickname:this.state.localUser.getNickname()})}},{key:"deleteSubscriber",value:function(e){var t=this.state.subscribers,a=t.filter((function(t){return t.getStreamManager().stream===e}))[0],i=t.indexOf(a,0);i>-1&&(t.splice(i,1),this.setState({subscribers:t}))}},{key:"subscribeToStreamCreated",value:function(){var e=this;this.state.session.on("streamCreated",(function(t){var a=e.state.session.subscribe(t.stream,void 0);a.on("streamPlaying",(function(t){e.checkSomeoneShareScreen(),a.videos[0].video.parentElement.classList.remove("custom-class")}));var i=new X;i.setStreamManager(a),i.setConnectionId(t.stream.connection.connectionId),i.setType("remote");var n=t.stream.connection.data.split("%")[0];i.setNickname(JSON.parse(n).clientData),e.remotes.push(i),e.localUserAccessAllowed&&e.updateSubscribers()}))}},{key:"subscribeToStreamDestroyed",value:function(){var e=this;this.state.session.on("streamDestroyed",(function(t){e.deleteSubscriber(t.stream),setTimeout((function(){e.checkSomeoneShareScreen()}),20),t.preventDefault(),e.updateLayout()}))}},{key:"subscribeToUserChanged",value:function(){var e=this;this.state.session.on("signal:userChanged",(function(t){var a=e.state.subscribers;a.forEach((function(e){if(e.getConnectionId()===t.from.connectionId){var a=JSON.parse(t.data);console.log("EVENTO REMOTE: ",t.data),void 0!==a.isAudioActive&&e.setAudioActive(a.isAudioActive),void 0!==a.isVideoActive&&e.setVideoActive(a.isVideoActive),void 0!==a.nickname&&e.setNickname(a.nickname),void 0!==a.isScreenShareActive&&e.setScreenShareActive(a.isScreenShareActive)}})),e.setState({subscribers:a},(function(){return e.checkSomeoneShareScreen()}))}))}},{key:"updateLayout",value:function(){var e=this;setTimeout((function(){e.layout.updateLayout()}),20)}},{key:"sendSignalUserChanged",value:function(e){var t={data:JSON.stringify(e),type:"userChanged"};this.state.session.signal(t)}},{key:"toggleFullscreen",value:function(){var e=window.document,t=e.getElementById("container");e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}},{key:"switchCamera",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,i,n,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.OV.getDevices();case 3:if(t=e.sent,!((a=t.filter((function(e){return"videoinput"===e.kind})))&&a.length>1)){e.next=15;break}if(!((i=a.filter((function(e){return e.deviceId!==s.state.currentVideoDevice.deviceId}))).length>0)){e.next=15;break}return n=this.OV.initPublisher(void 0,{audioSource:void 0,videoSource:i[0].deviceId,publishAudio:ye.isAudioActive(),publishVideo:ye.isVideoActive(),mirror:!0}),e.next=11,this.state.session.unpublish(this.state.localUser.getStreamManager());case 11:return e.next=13,this.state.session.publish(n);case 13:this.state.localUser.setStreamManager(n),this.setState({currentVideoDevice:i,localUser:ye});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error(e.t0);case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"screenShare",value:function(){var e=this,t=-1!==navigator.userAgent.indexOf("Firefox")?"window":"screen",a=this.OV.initPublisher(void 0,{videoSource:t,publishAudio:ye.isAudioActive(),publishVideo:ye.isVideoActive(),mirror:!1},(function(t){t&&"SCREEN_EXTENSION_NOT_INSTALLED"===t.name?e.setState({showExtensionDialog:!0}):t&&"SCREEN_SHARING_NOT_SUPPORTED"===t.name?alert("Your browser does not support screen sharing"):t&&"SCREEN_EXTENSION_DISABLED"===t.name?alert("You need to enable screen sharing extension"):t&&"SCREEN_CAPTURE_DENIED"===t.name&&alert("You need to choose a window or application to share")}));a.once("accessAllowed",(function(){e.state.session.unpublish(ye.getStreamManager()),ye.setStreamManager(a),e.state.session.publish(ye.getStreamManager()).then((function(){ye.setScreenShareActive(!0),e.setState({localUser:ye},(function(){e.sendSignalUserChanged({isScreenShareActive:ye.isScreenShareActive()})}))}))})),a.on("streamPlaying",(function(){e.updateLayout(),a.videos[0].video.parentElement.classList.remove("custom-class")}))}},{key:"closeDialogExtension",value:function(){this.setState({showExtensionDialog:!1})}},{key:"stopScreenShare",value:function(){this.state.session.unpublish(ye.getStreamManager()),this.connectWebCam()}},{key:"checkSomeoneShareScreen",value:function(){var e={maxRatio:1.5,minRatio:9/16,fixedRatio:this.state.subscribers.some((function(e){return e.isScreenShareActive()}))||ye.isScreenShareActive(),bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0};this.layout.setLayoutOptions(e),this.updateLayout()}},{key:"toggleChat",value:function(e){var t=e;void 0===t&&(t="none"===this.state.chatDisplay?"block":"none"),"block"===t?this.setState({chatDisplay:t,messageReceived:!1}):(console.log("chat",t),this.setState({chatDisplay:t})),this.updateLayout()}},{key:"checkNotification",value:function(e){this.setState({messageReceived:"none"===this.state.chatDisplay})}},{key:"checkSize",value:function(){document.getElementById("layout").offsetWidth<=700&&!this.hasBeenUpdated&&(this.toggleChat("none"),this.hasBeenUpdated=!0),document.getElementById("layout").offsetWidth>700&&this.hasBeenUpdated&&(this.hasBeenUpdated=!1)}},{key:"render",value:function(){var e=this.state.mySessionId,t=this.state.localUser,a={display:this.state.chatDisplay};return n.a.createElement("div",{className:"container",id:"container"},n.a.createElement(be,{sessionId:e,user:t,showNotification:this.state.messageReceived,camStatusChanged:this.camStatusChanged,micStatusChanged:this.micStatusChanged,screenShare:this.screenShare,stopScreenShare:this.stopScreenShare,toggleFullscreen:this.toggleFullscreen,switchCamera:this.switchCamera,leaveSession:this.leaveSession,toggleChat:this.toggleChat}),n.a.createElement(M,{showDialog:this.state.showExtensionDialog,cancelClicked:this.closeDialogExtension}),n.a.createElement("div",{id:"layout",className:"bounds"},void 0!==t&&void 0!==t.getStreamManager()&&n.a.createElement("div",{className:"OT_root OT_publisher custom-class",id:"localUser"},n.a.createElement(H,{user:t,handleNickname:this.nicknameChanged})),this.state.subscribers.map((function(e,t){return n.a.createElement("div",{key:t,className:"OT_root OT_publisher custom-class",id:"remoteUsers"},n.a.createElement(H,{user:e,streamId:e.streamManager.stream.streamId}))})),void 0!==t&&void 0!==t.getStreamManager()&&n.a.createElement("div",{className:"OT_root OT_publisher custom-class",style:a},n.a.createElement(O,{user:t,chatDisplay:this.state.chatDisplay,close:this.toggleChat,messageReceived:this.checkNotification}))))}},{key:"getToken",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createSession(this.state.mySessionId);case 2:return t=e.sent,e.next=5,this.createToken(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createSession",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post(!1+"api/sessions",{customSessionId:t},{headers:{"Content-Type":"application/json"}});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createToken",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post(!1+"api/sessions/"+t+"/connections",{},{headers:{"Content-Type":"application/json"}});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),a}(i.Component),Ce=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ee(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(n.a.createElement(ke,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");Ce?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ee(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Ee(e)}))}}()},96:function(e,t,a){}},[[121,1,2]]]);
//# sourceMappingURL=main.ef51bba1.chunk.js.map